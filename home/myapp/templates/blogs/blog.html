{% extends 'base.html' %}
{% load static %}

{% block title %}Blog - Wecamp{% endblock %}

{% block content %}

  <!-- Page Title -->
  <div class="page-title dark-background" data-aos="fade">
    <style>
        .page-title { background-image: url('{% static "assets/img/travel/showcase-8.webp" %}'); }
    </style>
    <div class="container position-relative">
      <h1>Blog</h1>
      <p>Khám phá những câu chuyện, kinh nghiệm và tin tức mới nhất từ Wecamp.</p>
      <nav class="breadcrumbs">
        <ol>
          <li><a href="{% url 'index' %}">Trang Chủ</a></li>
          <li class="current">Blog</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- Blog Hero Section -->
  {% if featured or headlines.exists %}
  <section id="blog-hero" class="blog-hero section">
    <div class="container" data-aos="fade-up" data-aos-delay="100">
      <div class="blog-grid">

        <!-- Bài viết nổi bật -->
        {% if featured %}
        <article class="blog-item main-feature" data-aos="fade-up">
          <img src="{{ featured.image.url }}" alt="{{ featured.title }}" class="img-fluid">
          <div class="blog-content">
            <div class="post-meta">
              <span class="date">{{ featured.published_at|date:"M. d, Y" }}</span>
              <span class="category">{{ featured.get_category_display }}</span>
            </div>
            <h2 class="post-title">
              <a href="{% url 'blog_details' featured.id %}" class="clamp-3-lines">{{ featured.title }}</a>
            </h2>
            <p class="post-excerpt">{{ featured.subtitle|default:"" }}</p>
          </div>
        </article>
        {% endif %}

        <!-- Bài viết tiêu đề -->
        {% if headlines.exists %}
        <div class="secondary-features">
          {% for post in headlines %}
          <article class="blog-item" data-aos="fade-up" data-aos-delay="{% if forloop.counter == 1 %}100{% else %}200{% endif %}">
            <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-fluid">
            <div class="blog-content">
              <div class="post-meta">
                <span class="date">{{ post.published_at|date:"M. d, Y" }}</span>
                <span class="category">{{ post.get_category_display }}</span>
              </div>
              <h3 class="post-title">
                <a href="{% url 'blog_details' post.id %}" class="clamp-3-lines">{{ post.title }}</a>
              </h3>
            </div>
          </article>
          {% endfor %}
        </div>
        {% endif %}

      </div>
    </div>
  </section>
  {% endif %}

  <!-- Bài viết thường -->
  <section id="blog-posts" class="blog-posts section">
    <div class="container" data-aos="fade-up" data-aos-delay="100">
      <div class="row gy-4">
        {% for post in regular_posts %}
        <div class="col-lg-4">
          <article>
            <div class="post-img">
              <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-fluid">
            </div>
            <p class="post-category">{{ post.get_category_display }}</p>
            <h2 class="title">
              <a href="{% url 'blog_details' post.id %}" class="clamp-3-lines">{{ post.title }}</a>
            </h2>
            <div class="d-flex align-items-center">
              {% if post.author_image %}
              <img src="{{ post.author_image.url }}" alt="{{ post.author_name }}" class="img-fluid post-author-img flex-shrink-0">
              {% else %}
              <img src="{% static 'assets/img/person/default-avatar.webp' %}" alt="Avatar" class="img-fluid post-author-img flex-shrink-0">
              {% endif %}
              <div class="post-meta">
                <p class="post-author">{{ post.author_name }}</p>
                <p class="post-date">
                  <time datetime="{{ post.published_at|date:'Y-m-d' }}">{{ post.published_at|date:"M d, Y" }}</time>
                </p>
              </div>
            </div>
          </article>
        </div>
        {% empty %}
        <div class="col-12 text-center">
          <p class="text-muted">Chưa có bài viết nào.</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- Pagination -->
  {% if regular_posts.has_other_pages %}
  <section id="pagination-2" class="pagination-2 section">
    <div class="container">
      <div class="d-flex justify-content-center">
        <ul>
          {% if regular_posts.has_previous %}
          <li><a href="?page={{ regular_posts.previous_page_number }}"><i class="bi bi-chevron-left"></i></a></li>
          {% endif %}
          {% for num in regular_posts.paginator.page_range %}
          {% if regular_posts.number == num %}
          <li><a href="#" class="active">{{ num }}</a></li>
          {% else %}
          <li><a href="?page={{ num }}">{{ num }}</a></li>
          {% endif %}
          {% endfor %}
          {% if regular_posts.has_next %}
          <li><a href="?page={{ regular_posts.next_page_number }}"><i class="bi bi-chevron-right"></i></a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </section>
  {% endif %}

{% endblock %}